<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>EXPO風 予約システム 完成版</title>

<style>

/* ========== 全体 EXPO 風 ========== */
body{
  font-family:"Noto Sans JP","Hiragino Sans",sans-serif;
  background:#ffffff;
  margin:0;
}

/* ---------- ヘッダー ---------- */
.header{
  background:#d80000;
  color:#fff;
  padding:10px;
  text-align:center;
  font-weight:700;
}

/* ---------- 予約リスト ---------- */
.container{
  padding:10px;
}

.row{
  border:1px solid #ccc;
  border-radius:6px;
  padding:10px;
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.state{
  width:22px;
  height:22px;
  border-radius:50%;
}

.ok{background:#1fa91f;}
.mid{background:#ffcc00;}
.ng{background:#c90000;}

.time{
  font-size:16px;
}

.selectBtn{
  border-radius:50%;
  border:2px solid #aaa;
  width:22px;
  height:22px;
}

/* ========== 遅延時のブラー ========== */
.waitMask{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  display:none;
  justify-content:center;
  align-items:center;
  color:#fff;
  font-size:18px;
  z-index:5000;
}

/* ========== 成功モーダル ========== */

.modalCover{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.75);
  display:flex;
  justify-content:center;
  align-items:center;
  visibility:hidden;
  z-index:9000;
}

.expo-modal{
  width:340px;
  background:#ffffff;
  border-radius:10px;
  border:1px solid #cfcfcf;
  text-align:center;
  padding:28px 18px 26px 18px;
  position:relative;
}

.expo-close{
  position:absolute;
  top:12px;
  right:14px;
  font-size:22px;
  cursor:pointer;
}

.expo-title{
  font-size:17px;
  font-weight:700;
  margin-bottom:14px;
  line-height:1.6em;
}

.expo-text{
  font-size:15px;
  line-height:1.9em;
}

.expo-btn{
  margin-top:24px;
  width:230px;
  height:48px;
  border:2px solid #111;
  border-radius:6px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  font-size:17px;
}


/* ========== 失敗モーダル ========== */

.modalCover-fail{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.75);
  display:flex;
  justify-content:center;
  align-items:center;
  visibility:hidden;
  z-index:9000;
}

.expo-modal-fail{
  width:340px;
  background:#ffffff;
  border-radius:10px;
  border:1px solid #cfcfcf;
  text-align:center;
  padding:28px 18px 26px 18px;
  position:relative;
}

.expo-close-fail{
  position:absolute;
  top:12px;
  right:14px;
  font-size:22px;
  cursor:pointer;
}

.expo-title-fail{
  font-size:17px;
  font-weight:700;
  margin-bottom:14px;
  line-height:1.6em;
}

.expo-text-fail{
  font-size:15px;
  line-height:1.9em;
}

.expo-btn-fail{
  margin-top:24px;
  width:230px;
  height:48px;
  border:2px solid #111;
  border-radius:6px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  font-size:17px;
}


/* ========== 順番待ち画面 ========== */

.waitPage{
  position:fixed;
  inset:0;
  background:#eee;
  display:none;
  text-align:center;
  padding-top:40px;
  z-index:9500;
}

.bar{
  width:80%;
  height:28px;
  background:#444;
  margin:30px auto;
  display:flex;
}

.green{
  width:0%;
  background:#00cc66;
}

</style>

</head>


<body>

<div class="header">EXPO風 予約ページ</div>

<div class="container">

  <div class="row">
    <div class="state ok"></div>
    <div class="time">10:00 - 10:20</div>
    <div class="selectBtn" onclick="reserve('10:00 - 10:20')"></div>
  </div>

  <div class="row">
    <div class="state mid"></div>
    <div class="time">11:00 - 11:20</div>
    <div class="selectBtn" onclick="reserve('11:00 - 11:20')"></div>
  </div>

  <div class="row">
    <div class="state ng"></div>
    <div class="time">12:00 - 12:20</div>
    <div class="selectBtn" onclick="reserve('12:00 - 12:20')"></div>
  </div>

</div>


<!-- ========== 遅延画面 ========== -->
<div class="waitMask" id="delayMask">
  処理中です…<br>
  しばらくお待ちください
</div>


<!-- ========== 成功モーダル ========== -->
<div class="modalCover" id="modalSuccess">
  <div class="expo-modal">
    <div class="expo-close" onclick="closeSuccess()">×</div>

    <div class="expo-title">
      ＜ 空き枠先着 ＞<br>
      パビリオン/イベントが<br>
      予約されました
    </div>

    <div class="expo-text" id="successTime">
    </div>

    <div class="expo-btn" onclick="closeSuccess()">とじる</div>
  </div>
</div>


<!-- ========== 失敗モーダル ========== -->
<div class="modalCover-fail" id="modalFail">
  <div class="expo-modal-fail">

    <div class="expo-close-fail" onclick="closeFail()">×</div>

    <div class="expo-title-fail">
      ＜ 当日登録 ＞<br>
      パビリオン/イベントの予約が<br>
      確保できませんでした
    </div>

    <div class="expo-text-fail">
      お手数ですが、<br>
      時間帯を再度選択してください
    </div>

    <div class="expo-btn-fail" onclick="closeFail()">とじる</div>

  </div>
</div>



<!-- ========== 順番待ちページ ========== -->
<div class="waitPage" id="waiting">
  <h2>順番にご案内しております。</h2>

  <p>
    現在サイトが大変混雑しております。<br>
    順番が来るまでお待ちください。
  </p>

  <div class="bar">
    <div class="green" id="greenBar"></div>
  </div>

  <div id="waitLine"></div>
</div>




<script>

// ------- 予約処理 --------
function reserve(time){
  
  document.getElementById("delayMask").style.display="flex";

  setTimeout(()=>{

    document.getElementById("delayMask").style.display="none";

    let r = Math.random();

    // 20% くらいで “順番待ち画面” に飛ばす
    if(r < 0.2){
        queueWait();
        return;
    }

    // 50% → 成功
    if(r < 0.7){
      document.getElementById("successTime").innerHTML =
      "予約枠：" + time;
      document.getElementById("modalSuccess").style.visibility="visible";
    }
    else{
      document.getElementById("modalFail").style.visibility="visible";
    }

  },1800);
}


// ------- 成功閉じる -------
function closeSuccess(){
  document.getElementById("modalSuccess").style.visibility="hidden";
}


// ------- 失敗閉じる -------
function closeFail(){
  document.getElementById("modalFail").style.visibility="hidden";
}


// ------- 順番待ち画面 -------
function queueWait(){

  document.getElementById("waiting").style.display="block";

  let bar = document.getElementById("greenBar");
  let text = document.getElementById("waitLine");

  let count = 0;

  let timer = setInterval(()=>{

      count++;
      bar.style.width = (count*10) + "%";
      text.innerHTML = "処理中 … " + count + "/10";

      if(count >= 10){
          clearInterval(timer);
          document.getElementById("waiting").style.display="none";
      }

  },800);

}

</script>

</body>
</html>
