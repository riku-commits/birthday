<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>やっちゃん誕生会 参加予約</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#e7f1ff;
  font-family: "Yu Gothic","メイリオ",sans-serif;
}

/* ===== メイン画面 ===== */
.container{
  width:720px;
  max-width:95%;
  margin:40px auto;
  background:white;
  border-radius:10px;
  padding:30px;
}

.title{
  font-weight:bold;
  font-size:20px;
}

.sub{
  color:#555;
  font-size:12px;
  margin-bottom:20px;
}

.slot{
  border:1px solid #ddd;
  border-radius:8px;
  padding:12px;
  margin:10px 0;
  display:flex;
  align-items:center;
  gap:15px;
}

.icon{
  font-size:22px;
  width:30px;
  text-align:center;
  font-weight:bold;
}

.ok{color:#007BFF;}
.mid{color:#e6a400;}
.ng{color:#ff2b2b;}

.bottomButton{
  background:#d80000;
  color:white;
  padding:18px;
  margin-top:25px;
  border-radius:8px;
  text-align:center;
  font-size:18px;
  cursor:pointer;
}

/* ===== モーダル ===== */
.modalBg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal{
  background:white;
  padding:25px;
  border-radius:10px;
  width:340px;
  text-align:center;
}

.big-text{
  font-size:18px;
  font-weight:bold;
  line-height:35px;
}

.modal button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:1px solid #333;
  border-radius:6px;
  background:white;
}

/* ===== 待機画面（本家寄せ） ===== */
.waitScreen{
  display:none;
  background:#3b3b3b;
  min-height:100vh;
  color:white;
  padding:30px;
  text-align:center;
}

.waitBox{
  max-width:750px;
  margin:0 auto;
  background:#4a4a4a;
  padding:25px;
  border-radius:10px;
}

.waitLogo{
  width:260px;
  margin:5px auto 20px;
}

.waitBarWrap{
  background:#222;
  border-radius:5px;
  padding:4px;
  margin-top:25px;
}

.waitBar{
  width:0%;
  height:18px;
  background:#00cc66;
  border-radius:4px;
  transition:width 0.3s;
}

.waitNum{
  margin-top:18px;
  font-size:18px;
}

/* ===== エラー画面 ===== */
.errorPage{
  display:none;
  text-align:center;
  padding:40px;
}

</style>
</head>

<body>

<!-- ▼ メイン画面 -->
<div id="mainScreen" class="container">

<div class="title">2025年12月30日(火)</div>
<div class="sub">やっちゃん誕生日会 参加時間帯を選んでください</div>

<!-- 8枠 -->
<div class="slot">
<span class="icon ok">○</span>
<input type="radio" name="time" value="18:00">18:00〜
</div>

<div class="slot">
<span class="icon mid">△</span>
<input type="radio" name="time" value="18:20">18:20〜
</div>

<div class="slot">
<span class="icon ok">○</span>
<input type="radio" name="time" value="18:40">18:40〜
</div>

<div class="slot">
<span class="icon ok">○</span>
<input type="radio" name="time" value="19:00">19:00〜
</div>

<div class="slot">
<span class="icon mid">△</span>
<input type="radio" name="time" value="19:20">19:20〜
</div>

<div class="slot">
<span class="icon ng">×</span>
<input type="radio" disabled>19:40〜
</div>

<div class="slot">
<span class="icon ok">○</span>
<input type="radio" name="time" value="20:00">20:00〜
</div>

<div class="slot">
<span class="icon mid">△</span>
<input type="radio" name="time" value="20:20">20:20〜
</div>

<div id="submitButton" class="bottomButton">
この時間で参加する →
</div>
</div>


<!-- ▼ 待機画面（10秒で戻る） -->
<div id="waitScreen" class="waitScreen">
  <div class="waitBox">

    <img class="waitLogo"
    src="https://www.expo2025.or.jp/wp-content/themes/expo2025/assets/img/common/logo.png">

    <h2>順番にご案内しております。</h2>

    <p>
      現在サイトが大変混雑しております。<br>
      順番が来るまでお待ちいただくか、時間をおいて再度アクセスしてください。
    </p>

    <div class="waitBarWrap">
      <div id="waitBar" class="waitBar"></div>
    </div>

    <div class="waitNum">
      ご自身の前に並んでいる人数：
      <span id="queueNum">470</span><br>
      待ち時間の目安：
      <span id="eta">約1分</span>
    </div>

    <div style="margin-top:12px;font-size:12px;">
      ※混雑状況によって変動する場合があります
    </div>

  </div>
</div>


<!-- ▼ エラー画面 -->
<div id="errorScreen" class="errorPage">
<h2>ご確認ください</h2>
<p>
アクセスが集中しているため処理を完了できませんでした。<br>
時間をおいて再度お試しください。
</p>
<button onclick="restart()">トップへもどる</button>
</div>


<!-- ▼ 予約成功 -->
<div id="success" class="modalBg">
<div class="modal">
<div class="big-text">
＜ 空き枠先着 ＞<br>
誕生日会の参加予約が<br>
確定しました！
</div>
<br>
<div id="successTime"></div>
<button onclick="closeAll()">とじる</button>
</div>
</div>


<!-- ▼ 予約失敗 -->
<div id="fail" class="modalBg">
<div class="modal">
<div class="big-text">
定員を超えたため、<br>
ご希望の時間帯は<br>
選択できませんでした
</div>
<br>
お手数ですが、時間帯を再度選択してください。
<button onclick="closeAll()">とじる</button>
</div>
</div>


<script>

const btn = document.getElementById("submitButton");

btn.addEventListener("click", ()=>{

 const checked = document.querySelector('input[name="time"]:checked');
 if(!checked){
   alert("時間帯を選択してください。");
   return;
 }

 btn.innerText = "処理中…";
 btn.style.opacity = "0.6";
 btn.style.pointerEvents = "none";

 const fate = Math.random();

 setTimeout(()=>{

   if(fate < 0.2){
     showWait();
     return;
   }

   if(fate < 0.4){
     showError();
     return;
   }

   if(fate < 0.7){
     showFail();
     return;
   }

   showSuccess(checked.value);

 },1200);
});



/* ===== 待機画面 ===== */
function showWait(){
  document.getElementById("mainScreen").style.display="none";
  document.getElementById("waitScreen").style.display="block";

  let bar = document.getElementById("waitBar");
  let num = document.getElementById("queueNum");

  let progress = 0;
  let people = 470;

  let timer = setInterval(()=>{
    progress += 5;
    people -= Math.floor(Math.random()*5)+1;

    if(progress>100) progress = 100;
    if(people<5) people = 5;

    bar.style.width = progress+"%";
    num.textContent = people;

  },500);

  setTimeout(()=>{
    clearInterval(timer);
    document.getElementById("waitScreen").style.display="none";
    document.getElementById("mainScreen").style.display="block";
    resetBtn();
  },10000);
}


/* ===== 各結果処理 ===== */
function showError(){
 document.getElementById("mainScreen").style.display="none";
 document.getElementById("errorScreen").style.display="block";
}

function showSuccess(time){
 document.getElementById("successTime").innerText="参加時間 "+time;
 document.getElementById("success").style.display="flex";
 resetBtn();
}

function showFail(){
 document.getElementById("fail").style.display="flex";
 resetBtn();
}

function closeAll(){
 document.querySelectorAll(".modalBg").forEach(m=>m.style.display="none");
}

function restart(){
 location.reload();
}

function resetBtn(){
 btn.innerText="この時間で参加する →";
 btn.style.opacity="1";
 btn.style.pointerEvents="auto";
}

</script>

</body>
</html>
