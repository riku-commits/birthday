<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚„ã£ã¡ã‚ƒã‚“èª•ç”Ÿæ—¥ä¼š å‚åŠ äºˆç´„ï¼ˆEXPOé¢¨ãƒ‡ãƒ¢ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI",
        "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN", "Hiragino Kaku Gothic ProN", "Yu Gothic",
        "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    /* --- Header / Global --- */
    header {
      background: #0074c8;
      color: #fff;
      padding: 8px 12px;
    }
    header .title-line1 {
      font-size: 11px;
      opacity: 0.9;
    }
    header .title-line2 {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.08em;
    }

    main {
      max-width: 480px;
      margin: 0 auto;
      background: #f5f5f5;
      min-height: 100vh;
      position: relative;
    }

    /* --- Main screen --- */
    #main-screen {
      padding: 16px 8px 100px;
    }

    .page-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .page-sub {
      font-size: 11px;
      color: #666;
      margin-bottom: 16px;
    }

    .card {
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 0 0 1px #ddd;
      overflow: hidden;
    }

    .time-row {
      display: flex;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding: 10px 12px;
      font-size: 14px;
    }
    .time-row:last-child {
      border-bottom: none;
    }

    .status-mark {
      width: 24px;
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      margin-right: 6px;
    }
    .status-open { color: #0074c8; }   /* é’ â—¯ */
    .status-few  { color: #f2a900; }   /* é»„ â–³ */
    .status-full { color: #e60033; }   /* èµ¤ Ã— */

    .time-radio {
      margin-right: 10px;
    }

    .time-label {
      flex: 1;
    }

    /* disabled row */
    .time-row.full-row {
      background: #f8f8f8;
      color: #aaa;
    }

    /* --- Bottom action area --- */
    .bottom-area {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      border-top: 1px solid #ddd;
      padding: 8px 8px 16px;
    }

    .selected-slot {
      text-align: center;
      font-size: 13px;
      margin-bottom: 8px;
      color: #666;
    }

    .btn-main {
      display: block;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      padding: 12px 0;
      border-radius: 4px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.05em;
      background: #e60033;
      color: #fff;
      cursor: pointer;
    }
    .btn-main:disabled {
      background: #f2b3c0;
      cursor: default;
    }

    /* --- Overlay common --- */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .hidden { display: none !important; }

    /* --- Modal (æˆåŠŸ/å¤±æ•—) --- */
    .modal-box {
      background: #fff;
      width: 90%;
      max-width: 360px;
      border-radius: 10px;
      padding: 20px 20px 24px;
      position: relative;
      box-shadow: 0 4px 16px rgba(0,0,0,0.25);
    }
    .modal-close-x {
      position: absolute;
      right: 14px;
      top: 10px;
      font-size: 20px;
      cursor: pointer;
    }
    .modal-title {
      text-align: center;
      font-weight: 700;
      margin-bottom: 12px;
      line-height: 1.6;
    }
    .modal-body {
      text-align: center;
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    .modal-icon {
      font-size: 48px;
      margin: 10px 0 16px;
    }
    .modal-time {
      font-size: 14px;
      margin-bottom: 18px;
    }
    .modal-button {
      width: 100%;
      padding: 10px 0;
      border-radius: 4px;
      border: 1px solid #111;
      background: #fff;
      font-size: 15px;
      cursor: pointer;
    }

    /* --- Loading overlay --- */
    #loading-overlay .loading-box {
      background: #fff;
      padding: 18px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.25);
      text-align: center;
      font-size: 14px;
    }
    .spinner {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 3px solid #eee;
      border-top-color: #0074c8;
      margin: 10px auto 0;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* --- Waiting screen --- */
    #waiting-screen {
      padding: 16px;
      max-width: 480px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    .wait-card {
      background: #fff;
      padding: 18px 16px 24px;
      border-radius: 8px;
      box-shadow: 0 0 0 1px #ddd;
    }
    .wait-logo {
      height: 56px;
      margin-bottom: 12px;
      background: #e60033;
      border-radius: 6px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      font-weight: 700;
      font-size: 18px;
    }
    .wait-title {
      font-size: 18px;
      font-weight: 700;
      margin: 10px 0 8px;
    }
    .wait-text {
      font-size: 13px;
      line-height: 1.7;
      margin-bottom: 10px;
    }
    .wait-bar {
      margin: 18px 0 10px;
      height: 18px;
      background: #444;
      border-radius: 10px;
      padding: 2px;
    }
    .wait-bar-inner {
      height: 100%;
      width: 0;
      border-radius: 8px;
      background: repeating-linear-gradient(
        to right,
        #00b060 0,
        #00b060 12px,
        #008a48 12px,
        #008a48 18px
      );
      animation: waitwalk 10s linear forwards;
    }
    @keyframes waitwalk {
      from { width: 0%; }
      to   { width: 100%; }
    }
    .wait-footer {
      font-size: 13px;
      line-height: 1.7;
      margin-top: 10px;
    }

    /* --- Fatal error screen --- */
    #error-screen {
      padding: 16px;
      max-width: 480px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    .error-card {
      background: #fff;
      padding: 20px 16px 24px;
      border-radius: 8px;
      box-shadow: 0 0 0 1px #ddd;
      text-align: center;
    }
    .error-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 14px;
    }
    .error-text {
      font-size: 13px;
      line-height: 1.8;
      margin-bottom: 18px;
      text-align: left;
    }
    .error-button {
      padding: 10px 18px;
      border-radius: 4px;
      border: 1px solid #e60033;
      background: #fff;
      color: #e60033;
      font-size: 14px;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <header>
    <div class="title-line1">EXPOé¢¨ ã‚„ã£ã¡ã‚ƒã‚“èª•ç”Ÿæ—¥ä¼šãƒã‚±ãƒƒãƒˆ</div>
    <div class="title-line2">ãƒ‡ã‚¸ã‚¿ãƒ«å‚åŠ äºˆç´„ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰</div>
  </header>

  <main>
    <!-- ===== ãƒ¡ã‚¤ãƒ³ç”»é¢ ===== -->
    <section id="main-screen">
      <div class="page-title">2025å¹´12æœˆ30æ—¥(ç«)</div>
      <div class="page-sub">ã‚„ã£ã¡ã‚ƒã‚“èª•ç”Ÿæ—¥ä¼šã®å‚åŠ æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>

      <div class="card" id="time-card">
        <!-- JSã§ 8 è¡Œã‚’åŸ‹ã‚è¾¼ã‚€ -->
      </div>
    </section>

    <div class="bottom-area">
      <div class="selected-slot" id="selected-label">æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
      <button id="submit-btn" class="btn-main" disabled>ã“ã®æ™‚é–“ã§å‚åŠ ã™ã‚‹ â†’</button>
    </div>
  </main>

  <!-- ===== ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ===== -->
  <div id="loading-overlay" class="overlay hidden">
    <div class="loading-box">
      é€šä¿¡ä¸­ã§ã™â€¦ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„
      <div class="spinner"></div>
    </div>
  </div>

  <!-- ===== æˆåŠŸ/å¤±æ•—ãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
  <div id="result-overlay" class="overlay hidden">
    <div class="modal-box">
      <div class="modal-close-x" id="result-close-x">Ã—</div>
      <div class="modal-title" id="result-title"></div>
      <div class="modal-icon">ğŸ“…</div>
      <div class="modal-time" id="result-time"></div>
      <div class="modal-body" id="result-body"></div>
      <button class="modal-button" id="result-button">ã¨ã˜ã‚‹</button>
    </div>
  </div>

  <!-- ===== å¾…æ©Ÿç”»é¢ ===== -->
  <section id="waiting-screen" class="hidden">
    <div class="wait-card">
      <div class="wait-logo">OSAKA 2025</div>
      <div class="wait-title">é †ç•ªã«ã”æ¡ˆå†…ã—ã¦ãŠã‚Šã¾ã™ã€‚</div>
      <p class="wait-text">
        ç¾åœ¨ã‚µã‚¤ãƒˆãŒå¤§å¤‰æ··é›‘ã—ã¦ãŠã‚Šã¾ã™ã€‚<br>
        é †ç•ªãŒæ¥ã‚‹ã¾ã§ãŠå¾…ã¡ã„ãŸã ãã‹ã€æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
      </p>
      <p class="wait-text">
        ãŠå¾…ã¡ã„ãŸã ãå ´åˆã«ã¯ã€ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ãšãŠå¾…ã¡ãã ã•ã„ã€‚<br>
        é †æ¬¡ãƒšãƒ¼ã‚¸ä¸Šã§ã”æ¡ˆå†…é–‹å§‹ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      </p>

      <div class="wait-bar">
        <div class="wait-bar-inner"></div>
      </div>

      <p class="wait-footer" id="wait-info"></p>
    </div>
  </section>

  <!-- ===== è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ç”»é¢ ===== -->
  <section id="error-screen" class="hidden">
    <div class="error-card">
      <div class="error-title">ã”ç¢ºèªãã ã•ã„</div>
      <div class="error-text">
        æ“ä½œãŒå®Œäº†ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚<br><br>
        ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰ã€ã‚‚ã†ä¸€åº¦ã¯ã˜ã‚ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚<br>
        èª•ç”Ÿæ—¥ä¼šã®é–‹å‚¬çŠ¶æ³ã«ã‚ˆã£ã¦ã¯ã€ç”»é¢ã«è¡¨ç¤ºã•ã‚ŒãŸå†…å®¹ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br><br>
        ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼šYACCHAN_GP_DL_004_9_900_16
      </div>
      <button class="error-button" id="error-back-btn">ã‚„ã£ã¡ã‚ƒã‚“èª•ç”Ÿæ—¥ä¼š ãƒˆãƒƒãƒ—ã¸ã‚‚ã©ã‚‹</button>
    </div>
  </section>

  <script>
    const times = [
      "18:00ã€œ18:20",
      "18:20ã€œ18:40",
      "18:40ã€œ19:00",
      "19:00ã€œ19:20",
      "19:20ã€œ19:40",
      "19:40ã€œ20:00",
      "20:00ã€œ20:20",
      "20:20ã€œ20:40"
    ];

    const WAIT_PROB = 0.4;        // å¾…æ©Ÿç”»é¢ã«é£›ã°ã•ã‚Œã‚‹ç¢ºç‡
    const FATAL_PROB = 0.15;      // ã„ããªã‚Šã‚¨ãƒ©ãƒ¼ç”»é¢
    let hasSucceededOnce = false; // ä¸€åº¦æˆåŠŸã—ãŸã‚‰ä»¥é™ã¯æˆåŠŸã—ã«ããã™ã‚‹

    const mainScreen   = document.getElementById("main-screen");
    const waitingScreen= document.getElementById("waiting-screen");
    const errorScreen  = document.getElementById("error-screen");
    const timeCard     = document.getElementById("time-card");
    const selectedLabel= document.getElementById("selected-label");
    const submitBtn    = document.getElementById("submit-btn");
    const loadingOverlay = document.getElementById("loading-overlay");

    const resultOverlay = document.getElementById("result-overlay");
    const resultTitle   = document.getElementById("result-title");
    const resultTime    = document.getElementById("result-time");
    const resultBody    = document.getElementById("result-body");
    const resultButton  = document.getElementById("result-button");
    const resultCloseX  = document.getElementById("result-close-x");

    const waitInfo      = document.getElementById("wait-info");
    const errorBackBtn  = document.getElementById("error-back-btn");

    let selectedSlotIndex = null;
    let selectedTimeText  = "";

    function createTimeRows() {
      timeCard.innerHTML = "";
      const statuses = randomStatuses();

      times.forEach((t, idx) => {
        const row = document.createElement("div");
        row.className = "time-row";
        row.dataset.index = idx;

        const markSpan = document.createElement("span");
        markSpan.className = "status-mark";

        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "time";
        radio.className = "time-radio";

        const label = document.createElement("div");
        label.className = "time-label";
        label.textContent = t;

        const status = statuses[idx];
        row.dataset.status = status;

        if (status === "open") {
          markSpan.textContent = "â—¯";
          markSpan.classList.add("status-open");
        } else if (status === "few") {
          markSpan.textContent = "â–³";
          markSpan.classList.add("status-few");
        } else {
          markSpan.textContent = "Ã—";
          markSpan.classList.add("status-full");
          row.classList.add("full-row");
          radio.disabled = true;
        }

        radio.addEventListener("change", () => {
          selectedSlotIndex = idx;
          selectedTimeText = t;
          selectedLabel.textContent = "é¸æŠä¸­ï¼š " + t;
          submitBtn.disabled = false;
        });

        row.appendChild(markSpan);
        row.appendChild(radio);
        row.appendChild(label);
        timeCard.appendChild(row);
      });

      selectedSlotIndex = null;
      selectedTimeText = "";
      selectedLabel.textContent = "æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„";
      submitBtn.disabled = true;
    }

    // çŠ¶æ…‹ã‚’ã„ã„æ„Ÿã˜ã«ãƒãƒ©ã‘ã•ã›ã‚‹
    function randomStatuses() {
      const statuses = [];
      let nonFullCount = 0;

      for (let i = 0; i < times.length; i++) {
        const r = Math.random();
        let s;
        if (r < 0.4) {
          s = "open";
        } else if (r < 0.7) {
          s = "few";
        } else {
          s = "full";
        }
        statuses.push(s);
        if (s !== "full") nonFullCount++;
      }

      // å…¨éƒ¨Ã—ã¯ã•ã™ãŒã«éŠã¹ãªã„ã®ã§ã€1ã¤ã ã‘â—¯ã«ã™ã‚‹
      if (nonFullCount === 0) {
        const pick = Math.floor(Math.random() * statuses.length);
        statuses[pick] = "open";
      }
      return statuses;
    }

    function showLoading() {
      loadingOverlay.classList.remove("hidden");
    }
    function hideLoading() {
      loadingOverlay.classList.add("hidden");
    }

    function goMain() {
      waitingScreen.classList.add("hidden");
      errorScreen.classList.add("hidden");
      mainScreen.classList.remove("hidden");
      createTimeRows();
    }

    function startFlow() {
      if (selectedSlotIndex === null) return;

      showLoading();
      submitBtn.disabled = true;

      const baseDelay = 3000 + Math.random() * 2000; // 3ã€œ5ç§’
      const r = Math.random();

      setTimeout(() => {
        hideLoading();

        if (r < WAIT_PROB) {
          // å¾…æ©Ÿç”»é¢
          goWaitingThenResult();
        } else if (r < WAIT_PROB + FATAL_PROB) {
          // è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼
          goFatalError();
        } else {
          // ç›´æ¥ æˆå¦
          showResultModal();
        }
      }, baseDelay);
    }

    function goWaitingThenResult() {
      mainScreen.classList.add("hidden");
      errorScreen.classList.add("hidden");
      waitingScreen.classList.remove("hidden");

      const queue = 200 + Math.floor(Math.random() * 600);
      const etaMin = 1 + Math.floor(Math.random() * 3);

      const now = new Date();
      const eta = new Date(now.getTime() + etaMin * 60000);
      const pad = (n) => (n < 10 ? "0" + n : "" + n);
      const etaStr = pad(eta.getHours()) + ":" + pad(eta.getMinutes()) + " JST";

      waitInfo.innerHTML =
        "ã”è‡ªèº«ã®å‰ã«ä¸¦ã‚“ã§ã„ã‚‹äººæ•°ï¼š" + queue + " äºº<br>" +
        "ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹æ¨å®šæ™‚åˆ»ï¼š" + etaStr + "<br>" +
        "å¾…ã¡æ™‚é–“ã®ç›®å®‰ï¼š" + etaMin + " åˆ†";

      // 10ç§’å¾Œã«å‹æ‰‹ã«çµæœã¸
      setTimeout(() => {
        waitingScreen.classList.add("hidden");
        mainScreen.classList.remove("hidden");
        showResultModal();
      }, 10000);
    }

    function goFatalError() {
      mainScreen.classList.add("hidden");
      waitingScreen.classList.add("hidden");
      errorScreen.classList.remove("hidden");
    }

    function showResultModal() {
      const afterWait = Math.random(); // æˆåŠŸ/å¤±æ•—ã®æ±ºå®š
      let isSuccess;

      if (!hasSucceededOnce) {
        isSuccess = afterWait < 0.35;  // åˆå›ã¯ã‚„ã‚„é«˜ã‚
      } else {
        isSuccess = afterWait < 0.1;   // 2å›ç›®ä»¥é™ã¯ã»ã¼å¤±æ•—
      }

      if (isSuccess) hasSucceededOnce = true;

      if (isSuccess) {
        resultTitle.textContent = "ï¼œ ç©ºãæ å…ˆç€ ï¼\nèª•ç”Ÿæ—¥ä¼šã®å‚åŠ äºˆç´„ãŒç¢ºå®šã—ã¾ã—ãŸ";
        resultBody.textContent = "ã“ã®æ™‚é–“å¸¯ã§ã€ã‚„ã£ã¡ã‚ƒã‚“èª•ç”Ÿæ—¥ä¼šã«å‚åŠ ã§ãã¾ã™ã€‚";
      } else {
        resultTitle.textContent = "å®šå“¡ã‚’è¶…ãˆãŸãŸã‚ã€ã”å¸Œæœ›ã®æ™‚é–“å¸¯ã¯\né¸æŠã§ãã¾ã›ã‚“ã§ã—ãŸ";
        resultBody.textContent = "ãŠæ‰‹æ•°ã§ã™ãŒã€æ¥å ´æ—¥æ™‚ã‚’å†åº¦é¸æŠã—ã¦ãã ã•ã„ã€‚";
      }
      resultTime.textContent = selectedTimeText;
      resultOverlay.classList.remove("hidden");

      // å¤±æ•—æ™‚ã¯é¸æŠã—ãŸæ ã‚’Ã—ã«å¤‰ãˆã¦ãŠãï¼ˆã‚¤ãƒ©ã¤ãæ¼”å‡ºï¼‰
      if (!isSuccess && selectedSlotIndex !== null) {
        const row = timeCard.querySelector(
          '.time-row[data-index="' + selectedSlotIndex + '"]'
        );
        if (row) {
          row.dataset.status = "full";
          row.classList.add("full-row");
          const mark = row.querySelector(".status-mark");
          mark.textContent = "Ã—";
          mark.className = "status-mark status-full";
          const radio = row.querySelector("input[type=radio]");
          radio.checked = false;
          radio.disabled = true;
        }
        selectedSlotIndex = null;
        selectedTimeText = "";
        selectedLabel.textContent = "æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„";
        submitBtn.disabled = true;
      }
    }

    function closeResultModal() {
      resultOverlay.classList.add("hidden");
      // å®Œå…¨ãƒªã‚»ãƒƒãƒˆã¯ã›ãšã€ã¡ã‚‡ã£ã¨ã ã‘çŠ¶æ³ãŒæ‚ªåŒ–ã—ãŸçŠ¶æ…‹ã§ç¶šè¡Œã•ã›ã‚‹
    }

    // ===== ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰ =====
    document.addEventListener("DOMContentLoaded", () => {
      createTimeRows();
      submitBtn.addEventListener("click", startFlow);
      resultButton.addEventListener("click", closeResultModal);
      resultCloseX.addEventListener("click", closeResultModal);
      errorBackBtn.addEventListener("click", goMain);
    });
  </script>
</body>
</html>
